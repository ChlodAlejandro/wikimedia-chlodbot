---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
    name: zoomiebot.wptc-index
    labels:
        name: zoomiebot.wptc-index
        toolforge: tool
spec:
    schedule: "0 * * * *"
    concurrencyPolicy: Replace
    successfulJobHistoryLimit: 10
    jobTemplate:
        spec:
            template:
                metadata:
                    labels:
                        toolforge: tool
                spec:
                    containers:
                        -   name: zoomiebot.wptc-index
                            image: docker-registry.tools.wmflabs.org/toolforge-buster-sssd-base:latest
                            command: [
                              # Start sh first to get run .profile data
                                    "/usr/bin/sh",
                              # Initialize environment
                                    "/data/project/redwarn/project/scripts/one-off.sh",
                              # Script to start
                                    "wptc-index"
                            ]
                            workingDir: /data/project/redwarn
                            env:
                                -   name: HOME
                                    value: /data/project/redwarn
                            imagePullPolicy: Always
                    restartPolicy: OnFailure
