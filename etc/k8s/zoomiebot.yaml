---
# Extended from the Deployment generated by the `webservice` command.
# See scripts/get_webservice_deployment.py for dumping script.

# Since `webservice` is no longer used to build routing resources,
# a separate script should be run to do those. See
# scripts/

apiVersion: apps/v1

kind: Deployment
metadata:
    labels:
        app.kubernetes.io/component: web
        app.kubernetes.io/managed-by: webservice
        name: zoomiebot
        toolforge: tool
        toolforge.org/mount-storage: all
    name: zoomiebot
    namespace: tool-zoomiebot
spec:
    replicas: 1
    selector:
        matchLabels:
            app.kubernetes.io/component: web
            name: zoomiebot
            toolforge: tool
    template:
        metadata:
            labels:
                app.kubernetes.io/component: web
                name: zoomiebot
                toolforge: tool
                toolforge.org/mount-storage: all
        spec:
            containers:
                - command: [ '/cnb/process/web' ]
                  image: tools-harbor.wmcloud.org/tool-zoomiebot/tool-zoomiebot:latest
                  name: webservice
                  env:
                      - {name: PORT, value: '8000'}
                      - {name: PUPPETEER_CHROME_PATH, value: '/layers/fagiani_apt/apt/usr/bin/chromium-browser'}
                  ports:
                      - {containerPort: 8000, name: http, protocol: TCP}
                  resources:
                      limits: {cpu: '0.125', memory: 1Gi}
                  stdin: false
                  tty: false
                  workingDir: /data/project/zoomiebot/
                - command: [ '/cnb/process/bot' ]
                  image: tools-harbor.wmcloud.org/tool-zoomiebot/tool-zoomiebot:latest
                  name: bot
                  env:
                      - {name: PORT, value: '8001'}
                      - {name: PUPPETEER_CHROME_PATH, value: '/layers/fagiani_apt/apt/usr/bin/chromium-browser'}
                  ports:
                      - {containerPort: 8001, name: http, protocol: TCP}
                  resources:
                      limits: {cpu: '0.5', memory: 1Gi}
                  stdin: false
                  tty: false
                  workingDir: /data/project/zoomiebot/project
